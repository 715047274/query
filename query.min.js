(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Query=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function objectify(a){var rows=[];for(var key in a){var o={};o[key]=a[key];rows.push(o)}return rows}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{enumerable:false,configurable:false,writable:false,value:function(searchString,position){position=position||0;return this.lastIndexOf(searchString,position)===position}})}if(!String.prototype.endsWith){Object.defineProperty(String.prototype,"endsWith",{value:function(searchString,position){var subjectString=this.toString();if(position===undefined||position>subjectString.length){position=subjectString.length}position-=searchString.length;var lastIndex=subjectString.indexOf(searchString,position);return lastIndex!==-1&&lastIndex===position}})}var Logic=module.exports={Query:function(constraints,getter){return function(row){return Logic.lhs._rowsatisfies(row,constraints,getter)}},query:function(rows,constraints,getter){if(typeof getter=="string"){var method=getter;getter=function(obj,key){return obj[method](key)}}var filter=new Logic.Query(constraints,getter);return rows.filter(filter)},lhs:{_rowsatisfies:function(row,constraints,getter){for(var key in constraints){if(this[key]){if(!this[key](row,constraints[key],getter))return false}else{var val=getter?getter(row,key):row[key];if(!this.rhs._satisfies(val,constraints[key],key))return false}}return true},$not:function(row,constraint,getter){return!this._rowsatisfies(row,constraint,getter)},$or:function(row,constraint,getter){if(!Array.isArray(constraint)){constraint=objectify(constraint)}for(var i=0;i<constraint.length;i++){if(this._rowsatisfies(row,constraint[i],getter))return true}return false},$and:function(row,constraint,getter){if(!Array.isArray(constraint)){constraint=objectify(constraint)}for(var i=0;i<constraint.length;i++){if(!this._rowsatisfies(row,constraint[i],getter))return false}return true},$nor:function(row,constraint,getter){return!this.$or(row,constraint,getter)},$where:function(values,ref){var fn=typeof ref=="string"?new Function(ref):ref;var res=fn.call(values);return res},rhs:{$cb:function(value,constraint,parentKey){return constraint(value)},_satisfies:function(value,constraint,parentKey){if(constraint==value){return true}else if(constraint instanceof RegExp){return this.$regex(value,constraint)}else if(typeof constraint==="object"){for(var key in constraint){if(!this[key]){return this.$eq(value,constraint,parentKey);throw new Error("Constraint function not recognized: "+key)}if(!this[key](value,constraint[key],parentKey)){return false}}return true}else if(constraint===""||constraint==null||constraint===undefined){return this.$null(value)}else{return this.$eq(value,constraint)}},$exists:function(value,constraint,parentKey){return value!=undefined==(constraint&&true)},$eq:function(value,constraint){if(Array.isArray(value)){for(var i=0;i<value.length;i++){if(this.$eq(value[i],constraint)){return true}}return false}return value==constraint},$deepEquals:function(value,constraint){if(typeof _=="undefined"||typeof _.isEqual=="undefined"){return JSON.stringify(value)==JSON.stringify(constraint)}else{return _.isEqual(value,constraint)}},$not:function(values,constraint){return!this._satisfies(values,constraint)},$ne:function(values,constraint){return!this._satisfies(values,constraint)},$nor:function(values,constraint,parentKey){return!this.$or(values,constraint,parentKey)},$and:function(values,constraint,parentKey){if(!Array.isArray(constraint)){throw new Error("Logic $and takes array of constraint objects")}for(var i=0;i<constraint.length;i++){var res=this._satisfies(values,constraint[i],parentKey);if(!res)return false}return true},$or:function(values,constraint,parentKey){if(!Array.isArray(values)){values=[values]}for(var v=0;v<values.length;v++){for(var i=0;i<constraint.length;i++){if(this._satisfies(values[v],constraint[i],parentKey)){return true}}}return false},$null:function(values){if(values===""||values===null||values===undefined){return true}else if(Array.isArray(values)){for(var v=0;v<values.length;v++){if(!(values[v]===""||values[v]===null||values===undefined)){return false}}return true}else return false},$in:function(values,constraint){if(!Array.isArray(constraint))throw new Error("$in requires an array operand");var result=false;if(!Array.isArray(values)){values=[values]}for(var v=0;v<values.length;v++){var val=values[v];for(var i=0;i<constraint.length;i++){if(this._satisfies(val,constraint[i])){result=true;break}}result=result||constraint.indexOf(val)>=0}return result},$likeI:function(values,constraint){return values.toLowerCase().indexOf(constraint)>=0},$like:function(values,constraint){return values.indexOf(constraint)>=0},$startsWith:function(values,constraint){if(!values)return false;return values.startsWith(constraint)},$endsWith:function(values,constraint){if(!values)return false;return values.endsWith(constraint)},$elemMatch:function(values,constraint,parentKey){for(var i=0;i<values.length;i++){if(Logic.lhs._rowsatisfies(values[i],constraint))return true}return false},$contains:function(values,constraint){return values.indexOf(constraint)>=0},$nin:function(values,constraint){return!this.$in(values,constraint)},$regex:function(values,constraint){var result=false;if(Array.isArray(values)){for(var i=0;i<values.length;i++){if(constraint.test(values)){result=true;break}}}else return constraint.test(values)},$gte:function(values,ref){return values>=ref},$gt:function(values,ref){return values>ref},$lt:function(values,ref){return values<ref},$lte:function(values,ref){return values<=ref},$type:function(values,ref){return typeof values==ref},$all:function(values,ref){throw new Error("$all not implemented")},$size:function(values,ref){return typeof values=="object"&&(values.length==ref||Object.keys(values).length==ref)},$mod:function(values,ref){return values%ref[0]==ref[1]},$equal:function(){return this.$eq(arguments)},$between:function(values,ref){return this._satisfies(values,{$gt:ref[0],$lt:ref[1]})}}}};Logic.undot=function(obj,key){var keys=key.split("."),sub=obj;for(var i=0;i<keys.length;i++){sub=sub[keys[i]]}return sub};Logic.lhs.rhs.$equal=Logic.lhs.rhs.$eq;Logic.lhs.rhs.$any=Logic.lhs.rhs.$or;Logic.lhs.rhs.$all=Logic.lhs.rhs.$and;RegExp.prototype.toJSON=RegExp.prototype.toString;module.exports=Logic},{}]},{},[1])(1)});